(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{249:function(s,t,a){"use strict";a.r(t);var e=a(19),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"第1章-了解sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第1章-了解sql"}},[s._v("#")]),s._v(" 第1章 了解SQL")]),s._v(" "),a("p",[s._v("模式（schema） 关于数据库和表的布局及特性的信息。有时，模式用作数据库的同义词。遗憾的是，模式的含义通常在上下文中并不是很清晰。")]),s._v(" "),a("p",[s._v("SQL不是一种专利语言，而且存在一个标准委员会，他们试图定义可供所有BMS使用的SQL语法，但事实上任意两个DBMS实现的SQL都不完全相同。")]),s._v(" "),a("h2",{attrs:{id:"第3章-使用mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第3章-使用mysql"}},[s._v("#")]),s._v(" 第3章 使用MySQL")]),s._v(" "),a("h3",{attrs:{id:"_3-2-选择数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-选择数据库"}},[s._v("#")]),s._v(" 3.2 选择数据库")]),s._v(" "),a("p",[s._v("如果只连接了DBMS，没有打开任何数据库，在语句中需要使用"),a("code",[s._v("use")]),s._v("选择某数据库。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" test_database"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("USE语句并不返回任何结果。")]),s._v(" "),a("h3",{attrs:{id:"_3-3-了解数据库和表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-了解数据库和表"}},[s._v("#")]),s._v(" 3.3 了解数据库和表")]),s._v(" "),a("ul",[a("li",[s._v("使用"),a("code",[s._v("SHOW DATABASES;")]),s._v("显示连接中可用的数据库。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("SHOW TABLES;")]),s._v("获取数据库内的表。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("SHOW COLUMNS FROM test_table;")]),s._v("显示表中的列的信息，包含列名，数据类型，是否允许Null，是否为键，默认值及其它信息。可以使用"),a("code",[s._v("DESCRIBE test_table")]),s._v("代替"),a("code",[s._v("SHOW COLUMNS FROM test_table;")]),s._v("。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("SHOW STATUS;")]),s._v("，用于显示广泛的服务器状态信息；")]),s._v(" "),a("li",[a("code",[s._v("SHOW CREATE DATABASE test_database;")]),s._v("和"),a("code",[s._v("SHOW CREATE TABLE sys_user;")]),s._v("，分别用来显示创建数据库或表的MySQL语句。")]),s._v(" "),a("li",[a("code",[s._v("SHOW ERRORS")]),s._v("和"),a("code",[s._v("SHOW WARNINGS")]),s._v("，用来显示服务器错误或警告消息。")])]),s._v(" "),a("h2",{attrs:{id:"第4章-检索数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第4章-检索数据"}},[s._v("#")]),s._v(" 第4章 检索数据")]),s._v(" "),a("p",[s._v("多条SQL语句必须以分号（;）分隔。如果你使用的是mysql命令行，必须加上分号来结束SQL语句。")]),s._v(" "),a("h3",{attrs:{id:"_4-1-select语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-select语句"}},[s._v("#")]),s._v(" 4.1 SELECT语句")]),s._v(" "),a("p",[s._v("请注意，SQL语句不区分大小写，因此SELECT与select是相同的。同样，写成Select也没有关系。许多SQL开发人员喜欢对所有SQL关键字使用大写，而对所有列和表名使用小写，这样做使代码更易于阅读和调试。")]),s._v(" "),a("h3",{attrs:{id:"_4-4-检索所有列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-检索所有列"}},[s._v("#")]),s._v(" 4.4 检索所有列")]),s._v(" "),a("p",[s._v("一般，除非你确实需要表中的每个列，否则最好别使用*通配符。虽然使用通配符可能会使你自己省事，不用明确列出所需列，但检索不需要的列通常会降低检索和应用程序的性能。")]),s._v(" "),a("h3",{attrs:{id:"_4-5-检索不同的行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-检索不同的行"}},[s._v("#")]),s._v(" 4.5 检索不同的行")]),s._v(" "),a("p",[a("code",[s._v("DISTINCT")]),s._v("关键字应用于所有列而不仅是前置它的列。")]),s._v(" "),a("h3",{attrs:{id:"_4-6-限制结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-限制结果"}},[s._v("#")]),s._v(" 4.6 限制结果")]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("LIMIT")]),s._v("限制结果的行数。"),a("code",[s._v("LIMIT 5")]),s._v("返回前五条，"),a("code",[s._v("LIMIT 5,5")]),s._v("返回从第五行开始的5行。检索出来的第一行为行0而不是行1。因此，"),a("code",[s._v("LIMIT 1,1")]),s._v("将检索出第二行而不是第一行。")]),s._v(" "),a("h2",{attrs:{id:"第5章-排序检索数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第5章-排序检索数据"}},[s._v("#")]),s._v(" 第5章 排序检索数据")]),s._v(" "),a("h3",{attrs:{id:"_5-1-排序数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-排序数据"}},[s._v("#")]),s._v(" 5.1 排序数据")]),s._v(" "),a("p",[s._v("如果不明确规定排序顺序，则认为检索结果无顺序意义。")]),s._v(" "),a("h3",{attrs:{id:"_5-2-按多个列排序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-按多个列排序"}},[s._v("#")]),s._v(" 5.2 按多个列排序")]),s._v(" "),a("p",[s._v("首先按第一列排序，然后按第二列排序。如果第一列都是唯一的，则不会按第二列排序。")]),s._v(" "),a("p",[s._v("在对文本性的数据进行排序时，A与 a相同吗？a位于B之前还是位于Z之后？这些问题不是理论问题，其答案取决于数据库如何设置。")]),s._v(" "),a("p",[s._v("在给出ORDER BY子句时，应该保证它位于FROM子句之后。如果使用LIMIT，它必须位于ORDER BY之后。")]),s._v(" "),a("h2",{attrs:{id:"第6章-过滤数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第6章-过滤数据"}},[s._v("#")]),s._v(" 第6章 过滤数据")]),s._v(" "),a("p",[s._v("单引号用来限定字符串。如果将值与串类型的列进行比较，则需要限定引号。用来与数值列进行比较的值不用引号。")]),s._v(" "),a("h3",{attrs:{id:"_6-2-3-范围值检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-3-范围值检查"}},[s._v("#")]),s._v(" 6.2.3 范围值检查")]),s._v(" "),a("p",[s._v("BETWEEN ... AND ... 包含头也包含尾。相当于 >= and <=")]),s._v(" "),a("h2",{attrs:{id:"第7章-数据过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第7章-数据过滤"}},[s._v("#")]),s._v(" 第7章 数据过滤")]),s._v(" "),a("h3",{attrs:{id:"_7-2-in操作符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-in操作符"}},[s._v("#")]),s._v(" 7.2 IN操作符")]),s._v(" "),a("p",[s._v("为什么要使用IN操作符？")]),s._v(" "),a("ul",[a("li",[s._v("在使用长的合法选项清单时，IN操作符的语法更清楚且更直观。")]),s._v(" "),a("li",[s._v("在使用IN时，计算的次序更容易管理（因为使用的操作符更少）。")]),s._v(" "),a("li",[s._v("IN操作符一般比OR操作符清单执行更快。")]),s._v(" "),a("li",[s._v("IN的最大优点是可以包含其他SELECT语句，使得能够更动态地建立WHERE子句。")])]),s._v(" "),a("h2",{attrs:{id:"第8章-用通配符进行过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第8章-用通配符进行过滤"}},[s._v("#")]),s._v(" 第8章 用通配符进行过滤")]),s._v(" "),a("h3",{attrs:{id:"_8-2-使用通配符的技巧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-使用通配符的技巧"}},[s._v("#")]),s._v(" 8.2 使用通配符的技巧")]),s._v(" "),a("p",[s._v("通配符搜索的处理一般要比前面讨论的其他搜索所花时间更长。")]),s._v(" "),a("ul",[a("li",[s._v("不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。")]),s._v(" "),a("li",[s._v("在确实需要使用通配符时，除非绝对有必要，否则不要把它们用在搜索模式的开始处。把通配符置于搜索模式的开始处，搜索起来是最慢的。")]),s._v(" "),a("li",[s._v("仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。")])]),s._v(" "),a("p",[s._v("MySQL默认的转义字符为''，如果要匹配字符串中带有'%'的，可以使用"),a("code",[s._v("like '%\\%%'")]),s._v("。如果要改变转义字符，使用"),a("code",[s._v("ESCAPE")]),s._v("。建议使用默认"),a("code",[s._v("\\")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("\n\tsys_user t\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v("\n\tt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%\\%%'")]),s._v("\n")])])]),a("h2",{attrs:{id:"第9章-用正则表达式进行搜索"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第9章-用正则表达式进行搜索"}},[s._v("#")]),s._v(" 第9章 用正则表达式进行搜索")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" prod_name\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" products\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" prod_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("REGEXP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n")])])]),a("p",[a("code",[s._v("REGEXP")]),s._v("为正则表达式匹配的关键字。 如果匹配串区分大小写，可用"),a("code",[s._v("REGEXP BINARY")]),s._v("。")]),s._v(" "),a("p",[s._v("多数正则表达式实现使用单个反斜杠转义特殊字符，以便能使用这些字符本身。但MySQL要求两个反斜杠（MySQL自己解释一个，正则表达式库解释另一个）。")]),s._v(" "),a("h2",{attrs:{id:"第10章-创建计算字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第10章-创建计算字段"}},[s._v("#")]),s._v(" 第10章 创建计算字段")]),s._v(" "),a("h3",{attrs:{id:"_10-2-拼接字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-拼接字段"}},[s._v("#")]),s._v(" 10.2 拼接字段")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("多数DBMS使用+或||来实现拼接，MySQL则使用Concat()函数来实现。当把SQL语句转换成MySQL语句时一定要把这个区别铭记在心。")])]),s._v(" "),a("p",[s._v("Trim函数 MySQL支持"),a("code",[s._v("RTrim()")]),s._v("，还支持"),a("code",[s._v("LTrim()")]),s._v("（去掉串左边的空格）以及"),a("code",[s._v("Trim()")]),s._v("（去掉串左右两边的空格）。")]),s._v(" "),a("h2",{attrs:{id:"第11章-使用数据处理函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第11章-使用数据处理函数"}},[s._v("#")]),s._v(" 第11章 使用数据处理函数")]),s._v(" "),a("h3",{attrs:{id:"_11-1-函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-函数"}},[s._v("#")]),s._v(" 11.1 函数")]),s._v(" "),a("p",[s._v("函数没有SQL的可移植性强。几乎每种主要的DBMS的实现都支持其他实现不支持的函数，而且有时差异还很大。")]),s._v(" "),a("h3",{attrs:{id:"_11-2-使用函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-使用函数"}},[s._v("#")]),s._v(" 11.2 使用函数")]),s._v(" "),a("h3",{attrs:{id:"_11-2-1-文本处理函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-1-文本处理函数"}},[s._v("#")]),s._v(" 11.2.1 文本处理函数")]),s._v(" "),a("ul",[a("li",[s._v("Upper()   将文本转换为大写")]),s._v(" "),a("li",[s._v("Left() 返回串左边的字符")]),s._v(" "),a("li",[s._v("Length() 返回串的长度")]),s._v(" "),a("li",[s._v("Locate() 找出串的一个子串")]),s._v(" "),a("li",[s._v("Lower() 将串转换为小写")]),s._v(" "),a("li",[s._v("LTrim() 去掉串左边的空格")]),s._v(" "),a("li",[s._v("Right() 返回串右边的字符")]),s._v(" "),a("li",[s._v("RTrim() 去掉串右边的空格")]),s._v(" "),a("li",[s._v("Soundex() 返回串的SOUNDEX值")]),s._v(" "),a("li",[s._v("SubString() 返回子串的字符")]),s._v(" "),a("li",[s._v("Upper() 将串转换为大写")])]),s._v(" "),a("h3",{attrs:{id:"_12-2-2-日期和时间处理函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-2-日期和时间处理函数"}},[s._v("#")]),s._v(" 12.2.2 日期和时间处理函数")]),s._v(" "),a("ul",[a("li",[s._v("AddDate() 增加一个日期（天、周等）")]),s._v(" "),a("li",[s._v("AddTime() 增加一个时间（时、分等）")]),s._v(" "),a("li",[s._v("CurDate() 返回当前日期")]),s._v(" "),a("li",[s._v("CurTime() 返回当前时间")]),s._v(" "),a("li",[s._v("Date() 返回日期时间的日期部分")]),s._v(" "),a("li",[s._v("DateDiff() 计算两个日期之差")]),s._v(" "),a("li",[s._v("Date_Add() 高度灵活的日期运算函数")]),s._v(" "),a("li",[s._v("Date_Format() 返回一个格式化的日期或时间串")]),s._v(" "),a("li",[s._v("Day() 返回一个日期的天数部分")]),s._v(" "),a("li",[s._v("DayOfWeek() 对于一个日期，返回对应的星期几")]),s._v(" "),a("li",[s._v("Hour() 返回一个时间的小时部分")]),s._v(" "),a("li",[s._v("Minute() 返回一个时间的分钟部分")]),s._v(" "),a("li",[s._v("Month() 返回一个日期的月份部分")]),s._v(" "),a("li",[s._v("Now() 返回当前日期和时间")]),s._v(" "),a("li",[s._v("Second() 返回一个时间的秒部分")]),s._v(" "),a("li",[s._v("Time() 返回一个日期时间的时间部分")]),s._v(" "),a("li",[s._v("Year() 返回一个日期的年份部分")])]),s._v(" "),a("p",[s._v("有时列数据类型是"),a("code",[s._v("datetime")]),s._v("，想要只根据日期筛选，则可以使用"),a("code",[s._v("Date()")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" cust_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" order_num\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" orders\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("order_date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2005-09-01'")]),s._v("\n")])])]),a("h3",{attrs:{id:"_11-2-3-数值处理函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-3-数值处理函数"}},[s._v("#")]),s._v(" 11.2.3 数值处理函数")]),s._v(" "),a("ul",[a("li",[s._v("Abs() 返回一个数的绝对值")]),s._v(" "),a("li",[s._v("Cos() 返回一个角度的余弦")]),s._v(" "),a("li",[s._v("Exp() 返回一个数的指数值")]),s._v(" "),a("li",[s._v("Mod() 返回除操作的余数")]),s._v(" "),a("li",[s._v("Pi() 返回圆周率")]),s._v(" "),a("li",[s._v("Rand() 返回一个随机数")]),s._v(" "),a("li",[s._v("Sin() 返回一个角度的正弦")]),s._v(" "),a("li",[s._v("Sqrt() 返回一个数的平方根")]),s._v(" "),a("li",[s._v("Tan() 返回一个角度的正切")])]),s._v(" "),a("h2",{attrs:{id:"第12章-汇总数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第12章-汇总数据"}},[s._v("#")]),s._v(" 第12章 汇总数据")]),s._v(" "),a("h3",{attrs:{id:"_12-1-聚集函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-聚集函数"}},[s._v("#")]),s._v(" 12.1 聚集函数")]),s._v(" "),a("ul",[a("li",[s._v("AVG() 返回某列的平均值")]),s._v(" "),a("li",[s._v("COUNT() 返回某列的行数")]),s._v(" "),a("li",[s._v("MAX() 返回某列的最大值")]),s._v(" "),a("li",[s._v("MIN() 返回某列的最小值")]),s._v(" "),a("li",[s._v("SUM() 返回某列值之和")])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("AVG()函数忽略列值为NULL的行。"),a("br"),s._v("\n使用COUNT(*)对表中行的数目进行计数，不管表列中包含的是空值（NULL）还是非空值。"),a("br"),s._v("\n使用COUNT(column)对特定列中具有值的行进行计数，忽略NULL值。")])]),s._v(" "),a("p",[s._v("可以在SUM()中使用计算表达式")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item_price"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("quantity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" total_price\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" orderitems\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" order_num "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20005")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h2",{attrs:{id:"第13章-分组数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第13章-分组数据"}},[s._v("#")]),s._v(" 第13章 分组数据")]),s._v(" "),a("p",[s._v("HAVING和WHERE的差别"),a("br"),s._v("\nWHERE在数据分组前进行过滤，HAVING在数据分组后进行过滤。这是一个重要的区别，WHERE排除的行不包括在分组中。")]),s._v(" "),a("h3",{attrs:{id:"_13-5-select子句顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-5-select子句顺序"}},[s._v("#")]),s._v(" 13.5 SELECT子句顺序")]),s._v(" "),a("p",[s._v("SELECT ... FROM ... WHERE ... GROUP BY ... HAVING ... ORDER BY ... LIMIT ...")]),s._v(" "),a("h2",{attrs:{id:"第14章-使用子查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第14章-使用子查询"}},[s._v("#")]),s._v(" 第14章 使用子查询")]),s._v(" "),a("p",[s._v("包含子查询的SELECT语句难以阅读和调试，特别是它们较为复杂时更是如此。把子查询分解为多行并且适当地进行缩进，能极大地简化子查询的使用。")]),s._v(" "),a("h2",{attrs:{id:"第15章-连接表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第15章-连接表"}},[s._v("#")]),s._v(" 第15章 连接表")]),s._v(" "),a("p",[s._v("MySQL在运行时关联指定的每个表以处理联结。这种处理可能是非常耗费资源的，因此应该仔细，不要联结不必要的表。联结的表越多，性能下降越厉害。")]),s._v(" "),a("p",[s._v("为执行任一给定的SQL操作，一般存在不止一种方法。很少有绝对正确或绝对错误的方法。性能可能会受操作类型、表中数据量、是否存在索引或键以及其他一些条件的影响。")]),s._v(" "),a("h2",{attrs:{id:"第22章-使用视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第22章-使用视图"}},[s._v("#")]),s._v(" 第22章 使用视图")]),s._v(" "),a("p",[s._v("视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询。")]),s._v(" "),a("ul",[a("li",[s._v("视图用"),a("code",[s._v("CREATE VIEW")]),s._v("语句来创建。")]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("SHOW CREATE VIEW viewname;")]),s._v("来查看创建视图的语句。")]),s._v(" "),a("li",[s._v("用"),a("code",[s._v("DROP")]),s._v("删除视图，其语法为"),a("code",[s._v("DROP VIEW viewname;")]),s._v("。")]),s._v(" "),a("li",[s._v("更新视图时，可以先用DROP再用CREATE，也可以直接用"),a("code",[s._v("CREATE OR REPLACE VIEW")]),s._v("。")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VIEW")]),s._v(" test_shitu "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" cust_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cust_contact"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" prod_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" customers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" orders"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" orderitems\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" customers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cust_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" orders"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cust_id\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" orderitems"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("order_num "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" orders"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("order_num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    \n")])])]),a("p",[s._v("利用视图，可一次性编写基础的SQL，然后根据需要多次使用。")]),s._v(" "),a("h3",{attrs:{id:"_22-1-视图的用途"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_22-1-视图的用途"}},[s._v("#")]),s._v(" 22.1 视图的用途")]),s._v(" "),a("ul",[a("li",[s._v("连接表，一次连接多次使用。")]),s._v(" "),a("li",[s._v("格式化数据。")]),s._v(" "),a("li",[s._v("过滤不需要的数据。")])]),s._v(" "),a("h3",{attrs:{id:"_22-2-5-更新视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_22-2-5-更新视图"}},[s._v("#")]),s._v(" 22.2.5 更新视图")]),s._v(" "),a("p",[s._v("通常，视图是可更新的。更新一个视图将更新其基表。但是，并非所有视图都是可更新的。基本上可以说，如果MySQL不能正确地确定被更新的基数据，则不允许更新。如果视图定义中有以下操作，则不能进行视图的更新：")]),s._v(" "),a("ul",[a("li",[s._v("分组（使用GROUP BY和HAVING）；")]),s._v(" "),a("li",[s._v("联结")]),s._v(" "),a("li",[s._v("子查询")]),s._v(" "),a("li",[s._v("并")]),s._v(" "),a("li",[s._v("聚集函数（Min()、Count()、Sum()等）；")]),s._v(" "),a("li",[s._v("DISTINCT")]),s._v(" "),a("li",[s._v("导出（计算）列。\n看上去是大多视图都不允许更新，这是因为视图主要用于数据检索。")])]),s._v(" "),a("h2",{attrs:{id:"第23章-使用存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第23章-使用存储过程"}},[s._v("#")]),s._v(" 第23章 使用存储过程")]),s._v(" "),a("h3",{attrs:{id:"_23-1-什么是存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-1-什么是存储过程"}},[s._v("#")]),s._v(" 23.1 什么是存储过程")]),s._v(" "),a("p",[s._v("使用的大多数SQL语句都是针对一个或多个表的单条语句。并非所有操作都这么简单，经常会有一个完整的操作需要多条语句才能完成。")]),s._v(" "),a("p",[s._v("存储过程简单来说，就是为以后的使用而保存的一条或多条MySQL语句的集合。可将其视为批文件，虽然它们的作用不仅限于批处理。")]),s._v(" "),a("p",[s._v("用存储过程有3个主要的好处，即简单、安全、高性能。")]),s._v(" "),a("p",[s._v("存储过程实际上是一种函数。")]),s._v(" "),a("h3",{attrs:{id:"_23-2-使用存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-2-使用存储过程"}},[s._v("#")]),s._v(" 23.2 使用存储过程")]),s._v(" "),a("h4",{attrs:{id:"_23-3-1-执行存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-3-1-执行存储过程"}},[s._v("#")]),s._v(" 23.3.1 执行存储过程")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CALL")]),s._v(" test_procedure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@pricelow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@pricehigh")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@priceaverage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("这句sql的作用是，调用并执行存储过程 test_produce,并传了3个参数。")]),s._v(" "),a("h4",{attrs:{id:"_23-3-2-创建存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-3-2-创建存储过程"}},[s._v("#")]),s._v(" 23.3.2 创建存储过程")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" test_procedure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Avg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prod_price"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" priceaverge\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" products\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("这句语句的意思是，创建一个名为 test_procedure 的存储过程，"),a("code",[s._v("BEGIN")]),s._v("和"),a("code",[s._v("END")]),s._v("用来限定存储过程体。这个存储过程没有参数，但后跟的()仍然需要。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("mysql命令行客户机的分隔符为;。如果直接在存储过程体中使用;,会被判断为语句结束，而不是过程体的分隔符。为了在使用存储过程时，将过程体和整个存储过程的分隔符区别开，解决方法是临时更改命令行实用程序的语句分隔符。")]),s._v(" "),a("p",[s._v("除\\符号外，任何字符都可以用作语句分隔符。")]),s._v(" "),a("p",[s._v("如果你使用的是mysql命令行实用程序，在使用存储过程时，注意临时更改语句分隔符。")])]),s._v(" "),a("p",[s._v("例如，在mysql命令行实用程序中，将语句分隔符临时更改为//。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" test_procedure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Avg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prod_price"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" priceaverage\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" products"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"_23-3-3-删除存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-3-3-删除存储过程"}},[s._v("#")]),s._v(" 23.3.3 删除存储过程")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" test_procedure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("请注意没有使用后面的()。仅在创建时和调用时需要()。")]),s._v(" "),a("p",[s._v("如果存储过程不存在，将产生一个错误。想避免这个错误可使用"),a("code",[s._v("DROP PROCEDURE IF EXISTS")])]),s._v(" "),a("h4",{attrs:{id:"_23-3-4-带参数的存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-3-4-带参数的存储过程"}},[s._v("#")]),s._v(" 23.3.4 带参数的存储过程")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" test_procedure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUT")]),s._v(" pl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUT")]),s._v(" ph "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUT")]),s._v(" pa "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("MIN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" pl\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("MAX")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" ph\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("AVG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" pa\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n")])])]),a("p",[s._v("此存储过程接受3个参数，"),a("code",[s._v("OUT")]),s._v("指出相应的参数用来从存储过程传出一个值。MySQL支持"),a("code",[s._v("IN")]),s._v(","),a("code",[s._v("OUT")]),s._v(","),a("code",[s._v("INOUT")]),s._v("类型的参数。"),a("code",[s._v("INTO")]),s._v("相当于赋值操作。")]),s._v(" "),a("p",[a("strong",[s._v("调用带参数的存储过程：")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CALL")]),s._v(" test_procedure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@c")]),s._v("\n")])])]),a("p",[s._v("MySQL使用"),a("code",[s._v("@")]),s._v("来表示变量，上述调用 test_procedure存储过程，将返回参数临时存储在三个变量中，并不直接显示。需要再次使用"),a("code",[s._v("SELECT")]),s._v("查询结果。")]),s._v(" "),a("p",[a("strong",[s._v("使用IN和OUT")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" test_procedure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" userid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUT")]),s._v(" telphone "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("avg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" telphone\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sys_user\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" user_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" userid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n")])])]),a("p",[s._v("调用")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CALL")]),s._v(" test_procedure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9996993128955904")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@tel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@tel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_23-3-5-建立智能存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-3-5-建立智能存储过程"}},[s._v("#")]),s._v(" 23.3.5 建立智能存储过程")]),s._v(" "),a("p",[s._v("上述存储过程中，只封装了简单的"),a("code",[s._v("SELECT")]),s._v("语句，这些存储过程直接用被封装的语句就可以完成。使用存储过程反而是过度设计了。")]),s._v(" "),a("p",[s._v("只有在存储过程内包含业务规则和智能处理时，它们的威力才真正显现出来。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" ordertotal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" onum "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" taxtable "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BOOLEAN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUT")]),s._v(" ototal "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECIMAL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" total "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECIMAL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" taxrate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item_price"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("quantity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" orderitems\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" order_num "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" onumber\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" taxtable "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" total"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("taxrate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" total "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" ototal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n")])])]),a("p",[s._v("使用"),a("code",[s._v("DECLARE")]),s._v("可以在存储过程中声明变量，使用"),a("code",[s._v("IF ... THEN ... END IF;")]),s._v("判断条件。")]),s._v(" "),a("h4",{attrs:{id:"_23-3-6-检查存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_23-3-6-检查存储过程"}},[s._v("#")]),s._v(" 23.3.6 检查存储过程")]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("SHOW CREATE PROCEDURE")]),s._v("查看存储过程定义。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" test_procedure\n")])])]),a("h2",{attrs:{id:"第24章-使用游标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第24章-使用游标"}},[s._v("#")]),s._v(" 第24章 使用游标")]),s._v(" "),a("h3",{attrs:{id:"_24-1-什么是游标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_24-1-什么是游标"}},[s._v("#")]),s._v(" 24.1 什么是游标")]),s._v(" "),a("p",[s._v("MySQL检索操作返回一组称为结果集的行。这组返回的行都是与SQL语句相匹配的行（零行或多行）。使用简单的"),a("code",[s._v("SELECT")]),s._v("语句，例如，没有办法得到第一行、下一行或前10行，也不存在每次一行地处理所有行的简单方法（相对于成批地处理它们）。")]),s._v(" "),a("p",[s._v("有时，需要在检索出来的行中前进或后退一行或多行。这就是使用游标的原因。游标（cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。")]),s._v(" "),a("p",[s._v("不像多数DBMS，MySQL游标只能用于存储过程（和函数）。")]),s._v(" "),a("h3",{attrs:{id:"_24-2-如何使用游标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_24-2-如何使用游标"}},[s._v("#")]),s._v(" 24.2 如何使用游标")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" test_procedure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" done "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BOOLEAN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" o "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" ordernumbers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURSOR")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" user_id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" sys_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CONTINUE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HANDLER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" SQLSTATE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'02000'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" done "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPEN")]),s._v(" ordernumbers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEAT")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FETCH")]),s._v(" ordernumbers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tUNTIL done "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEAT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CLOSE")]),s._v(" ordernumbers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("DECLARE ordernumbers CURSOR FOR ...")]),s._v("，为查询设置一个游标。"),a("code",[s._v("DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1;")]),s._v("是在条件出现时被执行的代码。这里，它指出当SQLSTATE '02000'出现时，SET done=1。SQLSTATE为02000代表无更多数据。")])]),s._v(" "),a("h2",{attrs:{id:"第25章-使用触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第25章-使用触发器"}},[s._v("#")]),s._v(" 第25章 使用触发器")]),s._v(" "),a("h3",{attrs:{id:"_25-1-什么是触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_25-1-什么是触发器"}},[s._v("#")]),s._v(" 25.1 什么是触发器")]),s._v(" "),a("p",[s._v("如果我们想要某些语句在事件发生时自动执行。这时候就要使用触发器。触发器是MySQL响应以下任意语句而自动执行的一条MySQL语句。")]),s._v(" "),a("ul",[a("li",[s._v("DELETE")]),s._v(" "),a("li",[s._v("INSERT")]),s._v(" "),a("li",[s._v("UPDATE\n其它MySQL语句不支持触发器。")])]),s._v(" "),a("h3",{attrs:{id:"_25-2-创建触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_25-2-创建触发器"}},[s._v("#")]),s._v(" 25.2 创建触发器")]),s._v(" "),a("p",[s._v("触发器必须在每个表中唯一，而不是在每个数据库中唯一。数据库中的两个表可具有相同名字的触发器。但是最好使用唯一的触发器名。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRIGGER")]),s._v(" test_trigger "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AFTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" sys_user\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR EACH ROW")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'User added'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("只有表才支持触发器，视图不支持。每个表最多支持6个触发器（每条INSERT、UPDATE和DELETE的之前和之后）。")]),s._v(" "),a("h3",{attrs:{id:"_25-3-删除触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_25-3-删除触发器"}},[s._v("#")]),s._v(" 25.3 删除触发器")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRIGGER")]),s._v(" test_trigger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("触发器不能更新或覆盖，只能删除重新创建。")]),s._v(" "),a("h3",{attrs:{id:"_25-4-触发器实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_25-4-触发器实例"}},[s._v("#")]),s._v(" 25.4 触发器实例")]),s._v(" "),a("p",[a("strong",[s._v("INSERT")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRIGGER")]),s._v(" test_trigger "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AFTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" sys_user\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR EACH ROW")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" NEW"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user_id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n")])])]),a("p",[a("code",[s._v("INSERT")]),s._v("触发器内，可引用虚拟表"),a("code",[s._v("NEW")]),s._v("，访问被插入的行。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("webframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("sys_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("loginname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'638a0bd2e278d57416c5492042441920f46c20d312881c22'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[a("strong",[s._v("----------------DELETE-----------------")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRIGGER")]),s._v(" test_trigger "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AFTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELETE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" sys_user\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR EACH ROW")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" OLD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user_id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n")])])]),a("p",[a("code",[s._v("DELETE")]),s._v("触发器内，可引用虚拟表"),a("code",[s._v("OLD")]),s._v("，访问被删除的行。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELETE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" sys_user "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" user_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[a("strong",[s._v("----------------UPDATE-----------------")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRIGGER")]),s._v(" test_trigger BEFORE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" sys_user\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR EACH ROW")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" NEW"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UPPER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NEW"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n")])])]),a("p",[s._v("在UPDATE触发器代码中，你可以引用一个名为OLD的虚拟表访问以前（UPDATE语句前）的值，引用一个名为NEW的虚拟表访问新更新的值；")]),s._v(" "),a("p",[s._v("在BEFORE UPDATE触发器中，NEW中的值可能也被更新（允许更改将要用于UPDATE语句中的值）；")]),s._v(" "),a("p",[s._v("每次更新一个行时，NEW.username中的值（将用来更新表行的值）都用Upper(NEW.username)替换。")]),s._v(" "),a("h3",{attrs:{id:"_25-4-4-关于触发器的进一步介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_25-4-4-关于触发器的进一步介绍"}},[s._v("#")]),s._v(" 25.4.4 关于触发器的进一步介绍")]),s._v(" "),a("p",[s._v("使用触发器，把更改（如果需要，甚至还有之前和之后的状态）记录到另一个表非常容易。可以用来做日志。")]),s._v(" "),a("p",[s._v("MySQL触发器中不支持CALL语句。这表示不能从触发器内调用存储过程。所需的存储过程代码需要复制到触发器内。")]),s._v(" "),a("h2",{attrs:{id:"第26章-管理事务处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第26章-管理事务处理"}},[s._v("#")]),s._v(" 第26章 管理事务处理")]),s._v(" "),a("p",[s._v("事务处理用来管理"),a("code",[s._v("INSERT")]),s._v("、"),a("code",[s._v("UPDATE")]),s._v("和"),a("code",[s._v("DELETE")]),s._v("语句。你不能回退"),a("code",[s._v("SELECT")]),s._v("语句。（这样做也没有什么意义。）你不能回退"),a("code",[s._v("CREATE")]),s._v("或"),a("code",[s._v("DROP")]),s._v("操作。事务处理块中可以使用这两条语句，但如果你执行回退，它们不会被撤销。")]),s._v(" "),a("h3",{attrs:{id:"_26-2-控制事务处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_26-2-控制事务处理"}},[s._v("#")]),s._v(" 26.2 控制事务处理")]),s._v(" "),a("h4",{attrs:{id:"_26-2-3-使用保留点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_26-2-3-使用保留点"}},[s._v("#")]),s._v(" 26.2.3 使用保留点")]),s._v(" "),a("p",[s._v("有时候想部分回滚事务，这时候就要使用保留点。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SAVEPOINT")]),s._v(" point1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ROLLBACK")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" point1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("使用"),a("code",[s._v("SAVEPOINT")]),s._v("在语句中设置一个保留点，在回滚时设置回滚至保留点。")]),s._v(" "),a("h2",{attrs:{id:"第28章-安全管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第28章-安全管理"}},[s._v("#")]),s._v(" 第28章 安全管理")]),s._v(" "),a("h3",{attrs:{id:"_28-2-管理用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_28-2-管理用户"}},[s._v("#")]),s._v(" 28.2 管理用户")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"_28-2-1-创建用户账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_28-2-1-创建用户账号"}},[s._v("#")]),s._v(" 28.2.1 创建用户账号")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" test "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IDENTITY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("重命名用户名")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RENAME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" test "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" test1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"_28-2-2-删除用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_28-2-2-删除用户"}},[s._v("#")]),s._v(" 28.2.2 删除用户")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" test1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"_28-2-3-设置访问权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_28-2-3-设置访问权限"}},[s._v("#")]),s._v(" 28.2.3 设置访问权限")]),s._v(" "),a("p",[s._v("新创建的用户账号没有访问权限。它们能登录MySQL，但不能看到数据，不能执行任何数据库操作。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" GRANTS "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("MySQL的权限用用户名和主机名结合定义。如果不指定主机名，则使用默认的主机名%")]),s._v(" "),a("p",[s._v("授权：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" webframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("撤销权限，被撤销的访问权限必须存在，否则会出错。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REVOKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" webframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);