<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>目录 | 小二温不胜</title>
    <meta name="description" content="温不胜的blog">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.ea35a998.css" as="style"><link rel="preload" href="/assets/js/app.785a8a1a.js" as="script"><link rel="preload" href="/assets/js/2.fa3ecc99.js" as="script"><link rel="preload" href="/assets/js/36.acc00acd.js" as="script"><link rel="preload" href="/assets/js/3.10cb9937.js" as="script"><link rel="prefetch" href="/assets/js/10.a03c2ffe.js"><link rel="prefetch" href="/assets/js/11.a0a9a517.js"><link rel="prefetch" href="/assets/js/12.94078cac.js"><link rel="prefetch" href="/assets/js/13.58107504.js"><link rel="prefetch" href="/assets/js/14.6a9ff23a.js"><link rel="prefetch" href="/assets/js/15.e6716263.js"><link rel="prefetch" href="/assets/js/16.166690eb.js"><link rel="prefetch" href="/assets/js/17.065d163d.js"><link rel="prefetch" href="/assets/js/18.c001d191.js"><link rel="prefetch" href="/assets/js/19.48f58e56.js"><link rel="prefetch" href="/assets/js/20.6eb2b873.js"><link rel="prefetch" href="/assets/js/21.4ccbc126.js"><link rel="prefetch" href="/assets/js/22.4b992af8.js"><link rel="prefetch" href="/assets/js/23.a9df978f.js"><link rel="prefetch" href="/assets/js/24.8224fe24.js"><link rel="prefetch" href="/assets/js/25.929c3fca.js"><link rel="prefetch" href="/assets/js/26.5fffa4f6.js"><link rel="prefetch" href="/assets/js/27.8312e26b.js"><link rel="prefetch" href="/assets/js/28.f516dc05.js"><link rel="prefetch" href="/assets/js/29.d7646f10.js"><link rel="prefetch" href="/assets/js/30.7f0f5659.js"><link rel="prefetch" href="/assets/js/31.bf3f95fd.js"><link rel="prefetch" href="/assets/js/32.21859856.js"><link rel="prefetch" href="/assets/js/33.df54f036.js"><link rel="prefetch" href="/assets/js/34.d32884b1.js"><link rel="prefetch" href="/assets/js/35.7fa8ce22.js"><link rel="prefetch" href="/assets/js/37.b352e0c1.js"><link rel="prefetch" href="/assets/js/38.68785ff8.js"><link rel="prefetch" href="/assets/js/39.e37f6594.js"><link rel="prefetch" href="/assets/js/4.051963ca.js"><link rel="prefetch" href="/assets/js/40.5d640649.js"><link rel="prefetch" href="/assets/js/41.c1e075f0.js"><link rel="prefetch" href="/assets/js/42.4ee1816b.js"><link rel="prefetch" href="/assets/js/43.4ea6b969.js"><link rel="prefetch" href="/assets/js/44.cb5bc342.js"><link rel="prefetch" href="/assets/js/45.cefe6320.js"><link rel="prefetch" href="/assets/js/46.74d4ff2c.js"><link rel="prefetch" href="/assets/js/47.a9e71200.js"><link rel="prefetch" href="/assets/js/48.bb4727b1.js"><link rel="prefetch" href="/assets/js/49.9deee268.js"><link rel="prefetch" href="/assets/js/5.7c40eeda.js"><link rel="prefetch" href="/assets/js/50.d559a151.js"><link rel="prefetch" href="/assets/js/51.abd73547.js"><link rel="prefetch" href="/assets/js/52.9bc62628.js"><link rel="prefetch" href="/assets/js/53.88e272ca.js"><link rel="prefetch" href="/assets/js/54.b6a090aa.js"><link rel="prefetch" href="/assets/js/55.fdc458a3.js"><link rel="prefetch" href="/assets/js/56.a885bcdc.js"><link rel="prefetch" href="/assets/js/57.37441eb6.js"><link rel="prefetch" href="/assets/js/58.19b86401.js"><link rel="prefetch" href="/assets/js/59.853238eb.js"><link rel="prefetch" href="/assets/js/6.5d062d06.js"><link rel="prefetch" href="/assets/js/60.28901a22.js"><link rel="prefetch" href="/assets/js/61.96fda80f.js"><link rel="prefetch" href="/assets/js/62.3347723a.js"><link rel="prefetch" href="/assets/js/63.954ba144.js"><link rel="prefetch" href="/assets/js/64.e0e6b06a.js"><link rel="prefetch" href="/assets/js/65.e6ecc42e.js"><link rel="prefetch" href="/assets/js/66.30dd9563.js"><link rel="prefetch" href="/assets/js/67.437e497d.js"><link rel="prefetch" href="/assets/js/68.d013dae2.js"><link rel="prefetch" href="/assets/js/69.1924d084.js"><link rel="prefetch" href="/assets/js/7.56a23a8d.js"><link rel="prefetch" href="/assets/js/70.2bbe024e.js"><link rel="prefetch" href="/assets/js/71.ddb66069.js"><link rel="prefetch" href="/assets/js/72.846a72e2.js"><link rel="prefetch" href="/assets/js/73.9bdba125.js"><link rel="prefetch" href="/assets/js/74.a84d7219.js"><link rel="prefetch" href="/assets/js/75.5af2cc4b.js"><link rel="prefetch" href="/assets/js/76.9a32bb01.js"><link rel="prefetch" href="/assets/js/77.c40cc487.js"><link rel="prefetch" href="/assets/js/78.14ee2300.js"><link rel="prefetch" href="/assets/js/79.468a3753.js"><link rel="prefetch" href="/assets/js/8.bca3974e.js"><link rel="prefetch" href="/assets/js/80.2f5f4350.js"><link rel="prefetch" href="/assets/js/81.94902926.js"><link rel="prefetch" href="/assets/js/82.fcc16b1b.js"><link rel="prefetch" href="/assets/js/83.1b74d889.js"><link rel="prefetch" href="/assets/js/84.70b64025.js"><link rel="prefetch" href="/assets/js/85.9a4600ed.js"><link rel="prefetch" href="/assets/js/86.118f3adf.js"><link rel="prefetch" href="/assets/js/87.cdb25364.js"><link rel="prefetch" href="/assets/js/88.a15205f6.js"><link rel="prefetch" href="/assets/js/89.8f22a96b.js"><link rel="prefetch" href="/assets/js/9.8b949133.js"><link rel="prefetch" href="/assets/js/90.fc849176.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ea35a998.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小二温不胜</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front/vue/" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/backend/go/" class="nav-link">
  Go
</a></li><li class="dropdown-item"><!----> <a href="/backend/internet/" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li><li class="dropdown-item"><!----> <a href="/database/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/linux/" class="nav-link">
  Linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/tools/navicat/" class="nav-link">
  Navicat
</a></li><li class="dropdown-item"><!----> <a href="/tools/maven/" class="nav-link">
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/tools/nginx/" class="nav-link">
  Nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/cicd/" class="nav-link">
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/others/sdk/" class="nav-link">
  SDK
</a></li><li class="dropdown-item"><!----> <a href="/others/issues/" class="nav-link">
  Issues
</a></li><li class="dropdown-item"><!----> <a href="/others/utils/" class="nav-link">
  Utils
</a></li><li class="dropdown-item"><!----> <a href="/others/work/" class="nav-link">
  工作记录
</a></li><li class="dropdown-item"><!----> <a href="/others/interview/" class="nav-link">
  面试宝典
</a></li></ul></div></div> <a href="https://github.com/JinbiaoYin/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front/vue/" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/backend/go/" class="nav-link">
  Go
</a></li><li class="dropdown-item"><!----> <a href="/backend/internet/" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li><li class="dropdown-item"><!----> <a href="/database/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/linux/" class="nav-link">
  Linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/tools/navicat/" class="nav-link">
  Navicat
</a></li><li class="dropdown-item"><!----> <a href="/tools/maven/" class="nav-link">
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/tools/nginx/" class="nav-link">
  Nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/cicd/" class="nav-link">
  CICD
</a></li><li class="dropdown-item"><!----> <a href="/others/sdk/" class="nav-link">
  SDK
</a></li><li class="dropdown-item"><!----> <a href="/others/issues/" class="nav-link">
  Issues
</a></li><li class="dropdown-item"><!----> <a href="/others/utils/" class="nav-link">
  Utils
</a></li><li class="dropdown-item"><!----> <a href="/others/work/" class="nav-link">
  工作记录
</a></li><li class="dropdown-item"><!----> <a href="/others/interview/" class="nav-link">
  面试宝典
</a></li></ul></div></div> <a href="https://github.com/JinbiaoYin/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>MYSQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/mysql/" class="sidebar-link">首页</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MySQL必知必会</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/mysql/a.html" class="active sidebar-link">目录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第1章-了解sql" class="sidebar-link">第1章 了解SQL</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第3章-使用mysql" class="sidebar-link">第3章 使用MySQL</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第4章-检索数据" class="sidebar-link">第4章 检索数据</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第5章-排序检索数据" class="sidebar-link">第5章 排序检索数据</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第6章-过滤数据" class="sidebar-link">第6章 过滤数据</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第7章-数据过滤" class="sidebar-link">第7章 数据过滤</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第8章-用通配符进行过滤" class="sidebar-link">第8章 用通配符进行过滤</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第9章-用正则表达式进行搜索" class="sidebar-link">第9章 用正则表达式进行搜索</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第10章-创建计算字段" class="sidebar-link">第10章 创建计算字段</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第11章-使用数据处理函数" class="sidebar-link">第11章 使用数据处理函数</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第12章-汇总数据" class="sidebar-link">第12章 汇总数据</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第13章-分组数据" class="sidebar-link">第13章 分组数据</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第14章-使用子查询" class="sidebar-link">第14章 使用子查询</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第15章-连接表" class="sidebar-link">第15章 连接表</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第22章-使用视图" class="sidebar-link">第22章 使用视图</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第23章-使用存储过程" class="sidebar-link">第23章 使用存储过程</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第24章-使用游标" class="sidebar-link">第24章 使用游标</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第25章-使用触发器" class="sidebar-link">第25章 使用触发器</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第26章-管理事务处理" class="sidebar-link">第26章 管理事务处理</a></li><li class="sidebar-sub-header"><a href="/database/mysql/a.html#第28章-安全管理" class="sidebar-link">第28章 安全管理</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>高性能 MySQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/mysql/b.html" class="sidebar-link">译者序</a></li><li><a href="/database/mysql/ba-1.html" class="sidebar-link">第1章 MySQL架构与历史</a></li><li><a href="/database/mysql/bb-2.html" class="sidebar-link">第2章 MySQL 基准测试</a></li><li><a href="/database/mysql/bc-3.html" class="sidebar-link">第3章 服务器性能剖析</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="第1章-了解sql"><a href="#第1章-了解sql" class="header-anchor">#</a> 第1章 了解SQL</h2> <p>模式（schema） 关于数据库和表的布局及特性的信息。有时，模式用作数据库的同义词。遗憾的是，模式的含义通常在上下文中并不是很清晰。</p> <p>SQL不是一种专利语言，而且存在一个标准委员会，他们试图定义可供所有BMS使用的SQL语法，但事实上任意两个DBMS实现的SQL都不完全相同。</p> <h2 id="第3章-使用mysql"><a href="#第3章-使用mysql" class="header-anchor">#</a> 第3章 使用MySQL</h2> <h3 id="_3-2-选择数据库"><a href="#_3-2-选择数据库" class="header-anchor">#</a> 3.2 选择数据库</h3> <p>如果只连接了DBMS，没有打开任何数据库，在语句中需要使用<code>use</code>选择某数据库。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">USE</span> test_database<span class="token punctuation">;</span>
</code></pre></div><p>USE语句并不返回任何结果。</p> <h3 id="_3-3-了解数据库和表"><a href="#_3-3-了解数据库和表" class="header-anchor">#</a> 3.3 了解数据库和表</h3> <ul><li>使用<code>SHOW DATABASES;</code>显示连接中可用的数据库。</li> <li>使用<code>SHOW TABLES;</code>获取数据库内的表。</li> <li>使用<code>SHOW COLUMNS FROM test_table;</code>显示表中的列的信息，包含列名，数据类型，是否允许Null，是否为键，默认值及其它信息。可以使用<code>DESCRIBE test_table</code>代替<code>SHOW COLUMNS FROM test_table;</code>。</li> <li>使用<code>SHOW STATUS;</code>，用于显示广泛的服务器状态信息；</li> <li><code>SHOW CREATE DATABASE test_database;</code>和<code>SHOW CREATE TABLE sys_user;</code>，分别用来显示创建数据库或表的MySQL语句。</li> <li><code>SHOW ERRORS</code>和<code>SHOW WARNINGS</code>，用来显示服务器错误或警告消息。</li></ul> <h2 id="第4章-检索数据"><a href="#第4章-检索数据" class="header-anchor">#</a> 第4章 检索数据</h2> <p>多条SQL语句必须以分号（;）分隔。如果你使用的是mysql命令行，必须加上分号来结束SQL语句。</p> <h3 id="_4-1-select语句"><a href="#_4-1-select语句" class="header-anchor">#</a> 4.1 SELECT语句</h3> <p>请注意，SQL语句不区分大小写，因此SELECT与select是相同的。同样，写成Select也没有关系。许多SQL开发人员喜欢对所有SQL关键字使用大写，而对所有列和表名使用小写，这样做使代码更易于阅读和调试。</p> <h3 id="_4-4-检索所有列"><a href="#_4-4-检索所有列" class="header-anchor">#</a> 4.4 检索所有列</h3> <p>一般，除非你确实需要表中的每个列，否则最好别使用*通配符。虽然使用通配符可能会使你自己省事，不用明确列出所需列，但检索不需要的列通常会降低检索和应用程序的性能。</p> <h3 id="_4-5-检索不同的行"><a href="#_4-5-检索不同的行" class="header-anchor">#</a> 4.5 检索不同的行</h3> <p><code>DISTINCT</code>关键字应用于所有列而不仅是前置它的列。</p> <h3 id="_4-6-限制结果"><a href="#_4-6-限制结果" class="header-anchor">#</a> 4.6 限制结果</h3> <p>使用<code>LIMIT</code>限制结果的行数。<code>LIMIT 5</code>返回前五条，<code>LIMIT 5,5</code>返回从第五行开始的5行。检索出来的第一行为行0而不是行1。因此，<code>LIMIT 1,1</code>将检索出第二行而不是第一行。</p> <h2 id="第5章-排序检索数据"><a href="#第5章-排序检索数据" class="header-anchor">#</a> 第5章 排序检索数据</h2> <h3 id="_5-1-排序数据"><a href="#_5-1-排序数据" class="header-anchor">#</a> 5.1 排序数据</h3> <p>如果不明确规定排序顺序，则认为检索结果无顺序意义。</p> <h3 id="_5-2-按多个列排序"><a href="#_5-2-按多个列排序" class="header-anchor">#</a> 5.2 按多个列排序</h3> <p>首先按第一列排序，然后按第二列排序。如果第一列都是唯一的，则不会按第二列排序。</p> <p>在对文本性的数据进行排序时，A与 a相同吗？a位于B之前还是位于Z之后？这些问题不是理论问题，其答案取决于数据库如何设置。</p> <p>在给出ORDER BY子句时，应该保证它位于FROM子句之后。如果使用LIMIT，它必须位于ORDER BY之后。</p> <h2 id="第6章-过滤数据"><a href="#第6章-过滤数据" class="header-anchor">#</a> 第6章 过滤数据</h2> <p>单引号用来限定字符串。如果将值与串类型的列进行比较，则需要限定引号。用来与数值列进行比较的值不用引号。</p> <h3 id="_6-2-3-范围值检查"><a href="#_6-2-3-范围值检查" class="header-anchor">#</a> 6.2.3 范围值检查</h3> <p>BETWEEN ... AND ... 包含头也包含尾。相当于 &gt;= and &lt;=</p> <h2 id="第7章-数据过滤"><a href="#第7章-数据过滤" class="header-anchor">#</a> 第7章 数据过滤</h2> <h3 id="_7-2-in操作符"><a href="#_7-2-in操作符" class="header-anchor">#</a> 7.2 IN操作符</h3> <p>为什么要使用IN操作符？</p> <ul><li>在使用长的合法选项清单时，IN操作符的语法更清楚且更直观。</li> <li>在使用IN时，计算的次序更容易管理（因为使用的操作符更少）。</li> <li>IN操作符一般比OR操作符清单执行更快。</li> <li>IN的最大优点是可以包含其他SELECT语句，使得能够更动态地建立WHERE子句。</li></ul> <h2 id="第8章-用通配符进行过滤"><a href="#第8章-用通配符进行过滤" class="header-anchor">#</a> 第8章 用通配符进行过滤</h2> <h3 id="_8-2-使用通配符的技巧"><a href="#_8-2-使用通配符的技巧" class="header-anchor">#</a> 8.2 使用通配符的技巧</h3> <p>通配符搜索的处理一般要比前面讨论的其他搜索所花时间更长。</p> <ul><li>不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。</li> <li>在确实需要使用通配符时，除非绝对有必要，否则不要把它们用在搜索模式的开始处。把通配符置于搜索模式的开始处，搜索起来是最慢的。</li> <li>仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。</li></ul> <p>MySQL默认的转义字符为''，如果要匹配字符串中带有'%'的，可以使用<code>like '%\%%'</code>。如果要改变转义字符，使用<code>ESCAPE</code>。建议使用默认<code>\</code>。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	<span class="token operator">*</span>
<span class="token keyword">FROM</span>
	sys_user t
<span class="token keyword">WHERE</span>
	t<span class="token punctuation">.</span>username <span class="token operator">LIKE</span> <span class="token string">'%\%%'</span>
</code></pre></div><h2 id="第9章-用正则表达式进行搜索"><a href="#第9章-用正则表达式进行搜索" class="header-anchor">#</a> 第9章 用正则表达式进行搜索</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">''</span>
</code></pre></div><p><code>REGEXP</code>为正则表达式匹配的关键字。 如果匹配串区分大小写，可用<code>REGEXP BINARY</code>。</p> <p>多数正则表达式实现使用单个反斜杠转义特殊字符，以便能使用这些字符本身。但MySQL要求两个反斜杠（MySQL自己解释一个，正则表达式库解释另一个）。</p> <h2 id="第10章-创建计算字段"><a href="#第10章-创建计算字段" class="header-anchor">#</a> 第10章 创建计算字段</h2> <h3 id="_10-2-拼接字段"><a href="#_10-2-拼接字段" class="header-anchor">#</a> 10.2 拼接字段</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>多数DBMS使用+或||来实现拼接，MySQL则使用Concat()函数来实现。当把SQL语句转换成MySQL语句时一定要把这个区别铭记在心。</p></div> <p>Trim函数 MySQL支持<code>RTrim()</code>，还支持<code>LTrim()</code>（去掉串左边的空格）以及<code>Trim()</code>（去掉串左右两边的空格）。</p> <h2 id="第11章-使用数据处理函数"><a href="#第11章-使用数据处理函数" class="header-anchor">#</a> 第11章 使用数据处理函数</h2> <h3 id="_11-1-函数"><a href="#_11-1-函数" class="header-anchor">#</a> 11.1 函数</h3> <p>函数没有SQL的可移植性强。几乎每种主要的DBMS的实现都支持其他实现不支持的函数，而且有时差异还很大。</p> <h3 id="_11-2-使用函数"><a href="#_11-2-使用函数" class="header-anchor">#</a> 11.2 使用函数</h3> <h3 id="_11-2-1-文本处理函数"><a href="#_11-2-1-文本处理函数" class="header-anchor">#</a> 11.2.1 文本处理函数</h3> <ul><li>Upper()   将文本转换为大写</li> <li>Left() 返回串左边的字符</li> <li>Length() 返回串的长度</li> <li>Locate() 找出串的一个子串</li> <li>Lower() 将串转换为小写</li> <li>LTrim() 去掉串左边的空格</li> <li>Right() 返回串右边的字符</li> <li>RTrim() 去掉串右边的空格</li> <li>Soundex() 返回串的SOUNDEX值</li> <li>SubString() 返回子串的字符</li> <li>Upper() 将串转换为大写</li></ul> <h3 id="_12-2-2-日期和时间处理函数"><a href="#_12-2-2-日期和时间处理函数" class="header-anchor">#</a> 12.2.2 日期和时间处理函数</h3> <ul><li>AddDate() 增加一个日期（天、周等）</li> <li>AddTime() 增加一个时间（时、分等）</li> <li>CurDate() 返回当前日期</li> <li>CurTime() 返回当前时间</li> <li>Date() 返回日期时间的日期部分</li> <li>DateDiff() 计算两个日期之差</li> <li>Date_Add() 高度灵活的日期运算函数</li> <li>Date_Format() 返回一个格式化的日期或时间串</li> <li>Day() 返回一个日期的天数部分</li> <li>DayOfWeek() 对于一个日期，返回对应的星期几</li> <li>Hour() 返回一个时间的小时部分</li> <li>Minute() 返回一个时间的分钟部分</li> <li>Month() 返回一个日期的月份部分</li> <li>Now() 返回当前日期和时间</li> <li>Second() 返回一个时间的秒部分</li> <li>Time() 返回一个日期时间的时间部分</li> <li>Year() 返回一个日期的年份部分</li></ul> <p>有时列数据类型是<code>datetime</code>，想要只根据日期筛选，则可以使用<code>Date()</code>。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> order_num
<span class="token keyword">FROM</span> orders
<span class="token keyword">WHERE</span> <span class="token keyword">Date</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'2005-09-01'</span>
</code></pre></div><h3 id="_11-2-3-数值处理函数"><a href="#_11-2-3-数值处理函数" class="header-anchor">#</a> 11.2.3 数值处理函数</h3> <ul><li>Abs() 返回一个数的绝对值</li> <li>Cos() 返回一个角度的余弦</li> <li>Exp() 返回一个数的指数值</li> <li>Mod() 返回除操作的余数</li> <li>Pi() 返回圆周率</li> <li>Rand() 返回一个随机数</li> <li>Sin() 返回一个角度的正弦</li> <li>Sqrt() 返回一个数的平方根</li> <li>Tan() 返回一个角度的正切</li></ul> <h2 id="第12章-汇总数据"><a href="#第12章-汇总数据" class="header-anchor">#</a> 第12章 汇总数据</h2> <h3 id="_12-1-聚集函数"><a href="#_12-1-聚集函数" class="header-anchor">#</a> 12.1 聚集函数</h3> <ul><li>AVG() 返回某列的平均值</li> <li>COUNT() 返回某列的行数</li> <li>MAX() 返回某列的最大值</li> <li>MIN() 返回某列的最小值</li> <li>SUM() 返回某列值之和</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>AVG()函数忽略列值为NULL的行。<br>
使用COUNT(*)对表中行的数目进行计数，不管表列中包含的是空值（NULL）还是非空值。<br>
使用COUNT(column)对特定列中具有值的行进行计数，忽略NULL值。</p></div> <p>可以在SUM()中使用计算表达式</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>item_price<span class="token operator">*</span>quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_price
<span class="token keyword">FROM</span> orderitems
<span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20005</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="第13章-分组数据"><a href="#第13章-分组数据" class="header-anchor">#</a> 第13章 分组数据</h2> <p>HAVING和WHERE的差别<br>
WHERE在数据分组前进行过滤，HAVING在数据分组后进行过滤。这是一个重要的区别，WHERE排除的行不包括在分组中。</p> <h3 id="_13-5-select子句顺序"><a href="#_13-5-select子句顺序" class="header-anchor">#</a> 13.5 SELECT子句顺序</h3> <p>SELECT ... FROM ... WHERE ... GROUP BY ... HAVING ... ORDER BY ... LIMIT ...</p> <h2 id="第14章-使用子查询"><a href="#第14章-使用子查询" class="header-anchor">#</a> 第14章 使用子查询</h2> <p>包含子查询的SELECT语句难以阅读和调试，特别是它们较为复杂时更是如此。把子查询分解为多行并且适当地进行缩进，能极大地简化子查询的使用。</p> <h2 id="第15章-连接表"><a href="#第15章-连接表" class="header-anchor">#</a> 第15章 连接表</h2> <p>MySQL在运行时关联指定的每个表以处理联结。这种处理可能是非常耗费资源的，因此应该仔细，不要联结不必要的表。联结的表越多，性能下降越厉害。</p> <p>为执行任一给定的SQL操作，一般存在不止一种方法。很少有绝对正确或绝对错误的方法。性能可能会受操作类型、表中数据量、是否存在索引或键以及其他一些条件的影响。</p> <h2 id="第22章-使用视图"><a href="#第22章-使用视图" class="header-anchor">#</a> 第22章 使用视图</h2> <p>视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询。</p> <ul><li>视图用<code>CREATE VIEW</code>语句来创建。</li> <li>使用<code>SHOW CREATE VIEW viewname;</code>来查看创建视图的语句。</li> <li>用<code>DROP</code>删除视图，其语法为<code>DROP VIEW viewname;</code>。</li> <li>更新视图时，可以先用DROP再用CREATE，也可以直接用<code>CREATE OR REPLACE VIEW</code>。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> test_shitu <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span>cust_contact<span class="token punctuation">,</span> prod_id
<span class="token keyword">FROM</span> customers<span class="token punctuation">,</span> orders<span class="token punctuation">,</span> orderitems
<span class="token keyword">WHERE</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id
<span class="token operator">AND</span> orderitems<span class="token punctuation">.</span>order_num <span class="token operator">=</span> orders<span class="token punctuation">.</span>order_num<span class="token punctuation">;</span>    
</code></pre></div><p>利用视图，可一次性编写基础的SQL，然后根据需要多次使用。</p> <h3 id="_22-1-视图的用途"><a href="#_22-1-视图的用途" class="header-anchor">#</a> 22.1 视图的用途</h3> <ul><li>连接表，一次连接多次使用。</li> <li>格式化数据。</li> <li>过滤不需要的数据。</li></ul> <h3 id="_22-2-5-更新视图"><a href="#_22-2-5-更新视图" class="header-anchor">#</a> 22.2.5 更新视图</h3> <p>通常，视图是可更新的。更新一个视图将更新其基表。但是，并非所有视图都是可更新的。基本上可以说，如果MySQL不能正确地确定被更新的基数据，则不允许更新。如果视图定义中有以下操作，则不能进行视图的更新：</p> <ul><li>分组（使用GROUP BY和HAVING）；</li> <li>联结</li> <li>子查询</li> <li>并</li> <li>聚集函数（Min()、Count()、Sum()等）；</li> <li>DISTINCT</li> <li>导出（计算）列。
看上去是大多视图都不允许更新，这是因为视图主要用于数据检索。</li></ul> <h2 id="第23章-使用存储过程"><a href="#第23章-使用存储过程" class="header-anchor">#</a> 第23章 使用存储过程</h2> <h3 id="_23-1-什么是存储过程"><a href="#_23-1-什么是存储过程" class="header-anchor">#</a> 23.1 什么是存储过程</h3> <p>使用的大多数SQL语句都是针对一个或多个表的单条语句。并非所有操作都这么简单，经常会有一个完整的操作需要多条语句才能完成。</p> <p>存储过程简单来说，就是为以后的使用而保存的一条或多条MySQL语句的集合。可将其视为批文件，虽然它们的作用不仅限于批处理。</p> <p>用存储过程有3个主要的好处，即简单、安全、高性能。</p> <p>存储过程实际上是一种函数。</p> <h3 id="_23-2-使用存储过程"><a href="#_23-2-使用存储过程" class="header-anchor">#</a> 23.2 使用存储过程</h3> <h4 id="_23-3-1-执行存储过程"><a href="#_23-3-1-执行存储过程" class="header-anchor">#</a> 23.3.1 执行存储过程</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CALL</span> test_procedure<span class="token punctuation">(</span><span class="token variable">@pricelow</span><span class="token punctuation">,</span><span class="token variable">@pricehigh</span><span class="token punctuation">,</span><span class="token variable">@priceaverage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这句sql的作用是，调用并执行存储过程 test_produce,并传了3个参数。</p> <h4 id="_23-3-2-创建存储过程"><a href="#_23-3-2-创建存储过程" class="header-anchor">#</a> 23.3.2 创建存储过程</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_procedure<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> <span class="token function">Avg</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> priceaverge
	<span class="token keyword">FROM</span> products
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre></div><p>这句语句的意思是，创建一个名为 test_procedure 的存储过程，<code>BEGIN</code>和<code>END</code>用来限定存储过程体。这个存储过程没有参数，但后跟的()仍然需要。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>mysql命令行客户机的分隔符为;。如果直接在存储过程体中使用;,会被判断为语句结束，而不是过程体的分隔符。为了在使用存储过程时，将过程体和整个存储过程的分隔符区别开，解决方法是临时更改命令行实用程序的语句分隔符。</p> <p>除\符号外，任何字符都可以用作语句分隔符。</p> <p>如果你使用的是mysql命令行实用程序，在使用存储过程时，注意临时更改语句分隔符。</p></div> <p>例如，在mysql命令行实用程序中，将语句分隔符临时更改为//。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_procedure<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> <span class="token function">Avg</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> priceaverage
	<span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>
<span class="token keyword">DELIMITER</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_23-3-3-删除存储过程"><a href="#_23-3-3-删除存储过程" class="header-anchor">#</a> 23.3.3 删除存储过程</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> test_procedure<span class="token punctuation">;</span>
</code></pre></div><p>请注意没有使用后面的()。仅在创建时和调用时需要()。</p> <p>如果存储过程不存在，将产生一个错误。想避免这个错误可使用<code>DROP PROCEDURE IF EXISTS</code></p> <h4 id="_23-3-4-带参数的存储过程"><a href="#_23-3-4-带参数的存储过程" class="header-anchor">#</a> 23.3.4 带参数的存储过程</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_procedure<span class="token punctuation">(</span><span class="token keyword">OUT</span> pl <span class="token keyword">BIGINT</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> ph <span class="token keyword">BIGINT</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> pa <span class="token keyword">BIGINT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">INTO</span> pl
  <span class="token keyword">FROM</span> sys_user<span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">INTO</span> ph
  <span class="token keyword">FROM</span> sys_user<span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">INTO</span> pa
  <span class="token keyword">FROM</span> sys_user<span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre></div><p>此存储过程接受3个参数，<code>OUT</code>指出相应的参数用来从存储过程传出一个值。MySQL支持<code>IN</code>,<code>OUT</code>,<code>INOUT</code>类型的参数。<code>INTO</code>相当于赋值操作。</p> <p><strong>调用带参数的存储过程：</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CALL</span> test_procedure<span class="token punctuation">(</span><span class="token variable">@a</span><span class="token punctuation">,</span><span class="token variable">@b</span><span class="token punctuation">,</span><span class="token variable">@c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@a</span><span class="token punctuation">,</span><span class="token variable">@b</span><span class="token punctuation">,</span><span class="token variable">@c</span>
</code></pre></div><p>MySQL使用<code>@</code>来表示变量，上述调用 test_procedure存储过程，将返回参数临时存储在三个变量中，并不直接显示。需要再次使用<code>SELECT</code>查询结果。</p> <p><strong>使用IN和OUT</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_procedure<span class="token punctuation">(</span><span class="token operator">IN</span> userid <span class="token keyword">BIGINT</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> telphone <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> <span class="token function">avg</span><span class="token punctuation">(</span>tel<span class="token punctuation">)</span> <span class="token keyword">INTO</span> telphone
	<span class="token keyword">FROM</span> sys_user
	<span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> userid<span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre></div><p>调用</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CALL</span> test_procedure<span class="token punctuation">(</span><span class="token number">9996993128955904</span><span class="token punctuation">,</span><span class="token variable">@tel</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@tel</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_23-3-5-建立智能存储过程"><a href="#_23-3-5-建立智能存储过程" class="header-anchor">#</a> 23.3.5 建立智能存储过程</h3> <p>上述存储过程中，只封装了简单的<code>SELECT</code>语句，这些存储过程直接用被封装的语句就可以完成。使用存储过程反而是过度设计了。</p> <p>只有在存储过程内包含业务规则和智能处理时，它们的威力才真正显现出来。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">(</span><span class="token operator">IN</span> onum <span class="token keyword">INT</span><span class="token punctuation">,</span><span class="token operator">IN</span> taxtable <span class="token keyword">BOOLEAN</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> ototal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> total <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> taxrate <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">6</span><span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> <span class="token function">Sum</span><span class="token punctuation">(</span>item_price<span class="token operator">*</span>quantity<span class="token punctuation">)</span>
	<span class="token keyword">FROM</span> orderitems
	<span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> onumber
	<span class="token keyword">INTO</span> total<span class="token punctuation">;</span>
	<span class="token keyword">IF</span> taxtable <span class="token keyword">THEN</span>
		<span class="token keyword">SELECT</span> total<span class="token operator">+</span><span class="token punctuation">(</span>total<span class="token operator">/</span><span class="token number">100</span><span class="token operator">*</span>taxrate<span class="token punctuation">)</span> <span class="token keyword">INTO</span> total<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> total <span class="token keyword">INTO</span> ototal<span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre></div><p>使用<code>DECLARE</code>可以在存储过程中声明变量，使用<code>IF ... THEN ... END IF;</code>判断条件。</p> <h4 id="_23-3-6-检查存储过程"><a href="#_23-3-6-检查存储过程" class="header-anchor">#</a> 23.3.6 检查存储过程</h4> <p>使用<code>SHOW CREATE PROCEDURE</code>查看存储过程定义。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_procedure
</code></pre></div><h2 id="第24章-使用游标"><a href="#第24章-使用游标" class="header-anchor">#</a> 第24章 使用游标</h2> <h3 id="_24-1-什么是游标"><a href="#_24-1-什么是游标" class="header-anchor">#</a> 24.1 什么是游标</h3> <p>MySQL检索操作返回一组称为结果集的行。这组返回的行都是与SQL语句相匹配的行（零行或多行）。使用简单的<code>SELECT</code>语句，例如，没有办法得到第一行、下一行或前10行，也不存在每次一行地处理所有行的简单方法（相对于成批地处理它们）。</p> <p>有时，需要在检索出来的行中前进或后退一行或多行。这就是使用游标的原因。游标（cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。</p> <p>不像多数DBMS，MySQL游标只能用于存储过程（和函数）。</p> <h3 id="_24-2-如何使用游标"><a href="#_24-2-如何使用游标" class="header-anchor">#</a> 24.2 如何使用游标</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_procedure<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> done <span class="token keyword">BOOLEAN</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> o <span class="token keyword">BIGINT</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> ordernumbers <span class="token keyword">CURSOR</span>
	<span class="token keyword">FOR</span>
	<span class="token keyword">SELECT</span> user_id <span class="token keyword">from</span> sys_user<span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLSTATE <span class="token string">'02000'</span> <span class="token keyword">SET</span> done <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">OPEN</span> ordernumbers<span class="token punctuation">;</span>
	<span class="token keyword">REPEAT</span>
		<span class="token keyword">FETCH</span> ordernumbers <span class="token keyword">INTO</span> o<span class="token punctuation">;</span>
	UNTIL done <span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
	<span class="token keyword">CLOSE</span> ordernumbers<span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>使用<code>DECLARE ordernumbers CURSOR FOR ...</code>，为查询设置一个游标。<code>DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1;</code>是在条件出现时被执行的代码。这里，它指出当SQLSTATE '02000'出现时，SET done=1。SQLSTATE为02000代表无更多数据。</p></div> <h2 id="第25章-使用触发器"><a href="#第25章-使用触发器" class="header-anchor">#</a> 第25章 使用触发器</h2> <h3 id="_25-1-什么是触发器"><a href="#_25-1-什么是触发器" class="header-anchor">#</a> 25.1 什么是触发器</h3> <p>如果我们想要某些语句在事件发生时自动执行。这时候就要使用触发器。触发器是MySQL响应以下任意语句而自动执行的一条MySQL语句。</p> <ul><li>DELETE</li> <li>INSERT</li> <li>UPDATE
其它MySQL语句不支持触发器。</li></ul> <h3 id="_25-2-创建触发器"><a href="#_25-2-创建触发器" class="header-anchor">#</a> 25.2 创建触发器</h3> <p>触发器必须在每个表中唯一，而不是在每个数据库中唯一。数据库中的两个表可具有相同名字的触发器。但是最好使用唯一的触发器名。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> test_trigger <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> sys_user
<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SELECT</span> <span class="token string">'User added'</span> <span class="token keyword">INTO</span> <span class="token variable">@a</span><span class="token punctuation">;</span>
</code></pre></div><p>只有表才支持触发器，视图不支持。每个表最多支持6个触发器（每条INSERT、UPDATE和DELETE的之前和之后）。</p> <h3 id="_25-3-删除触发器"><a href="#_25-3-删除触发器" class="header-anchor">#</a> 25.3 删除触发器</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> test_trigger<span class="token punctuation">;</span>
</code></pre></div><p>触发器不能更新或覆盖，只能删除重新创建。</p> <h3 id="_25-4-触发器实例"><a href="#_25-4-触发器实例" class="header-anchor">#</a> 25.4 触发器实例</h3> <p><strong>INSERT</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> test_trigger <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> sys_user
<span class="token keyword">FOR EACH ROW</span> 
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> NEW<span class="token punctuation">.</span>user_id <span class="token keyword">INTO</span> <span class="token variable">@a</span><span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre></div><p><code>INSERT</code>触发器内，可引用虚拟表<code>NEW</code>，访问被插入的行。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>webframe<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>loginname<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'638a0bd2e278d57416c5492042441920f46c20d312881c22'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@a</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>----------------DELETE-----------------</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> test_trigger <span class="token keyword">AFTER</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> sys_user
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> OLD<span class="token punctuation">.</span>user_id <span class="token keyword">INTO</span> <span class="token variable">@a</span><span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre></div><p><code>DELETE</code>触发器内，可引用虚拟表<code>OLD</code>，访问被删除的行。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">from</span> sys_user <span class="token keyword">where</span> user_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token variable">@a</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>----------------UPDATE-----------------</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> test_trigger BEFORE <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> sys_user
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SET</span> NEW<span class="token punctuation">.</span>username <span class="token operator">=</span> UPPER<span class="token punctuation">(</span>NEW<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre></div><p>在UPDATE触发器代码中，你可以引用一个名为OLD的虚拟表访问以前（UPDATE语句前）的值，引用一个名为NEW的虚拟表访问新更新的值；</p> <p>在BEFORE UPDATE触发器中，NEW中的值可能也被更新（允许更改将要用于UPDATE语句中的值）；</p> <p>每次更新一个行时，NEW.username中的值（将用来更新表行的值）都用Upper(NEW.username)替换。</p> <h3 id="_25-4-4-关于触发器的进一步介绍"><a href="#_25-4-4-关于触发器的进一步介绍" class="header-anchor">#</a> 25.4.4 关于触发器的进一步介绍</h3> <p>使用触发器，把更改（如果需要，甚至还有之前和之后的状态）记录到另一个表非常容易。可以用来做日志。</p> <p>MySQL触发器中不支持CALL语句。这表示不能从触发器内调用存储过程。所需的存储过程代码需要复制到触发器内。</p> <h2 id="第26章-管理事务处理"><a href="#第26章-管理事务处理" class="header-anchor">#</a> 第26章 管理事务处理</h2> <p>事务处理用来管理<code>INSERT</code>、<code>UPDATE</code>和<code>DELETE</code>语句。你不能回退<code>SELECT</code>语句。（这样做也没有什么意义。）你不能回退<code>CREATE</code>或<code>DROP</code>操作。事务处理块中可以使用这两条语句，但如果你执行回退，它们不会被撤销。</p> <h3 id="_26-2-控制事务处理"><a href="#_26-2-控制事务处理" class="header-anchor">#</a> 26.2 控制事务处理</h3> <h4 id="_26-2-3-使用保留点"><a href="#_26-2-3-使用保留点" class="header-anchor">#</a> 26.2.3 使用保留点</h4> <p>有时候想部分回滚事务，这时候就要使用保留点。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SAVEPOINT</span> point1<span class="token punctuation">;</span>
<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> point1<span class="token punctuation">;</span>
</code></pre></div><p>使用<code>SAVEPOINT</code>在语句中设置一个保留点，在回滚时设置回滚至保留点。</p> <h2 id="第28章-安全管理"><a href="#第28章-安全管理" class="header-anchor">#</a> 第28章 安全管理</h2> <h3 id="_28-2-管理用户"><a href="#_28-2-管理用户" class="header-anchor">#</a> 28.2 管理用户</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">USE</span> mysql<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_28-2-1-创建用户账号"><a href="#_28-2-1-创建用户账号" class="header-anchor">#</a> 28.2.1 创建用户账号</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> test <span class="token keyword">IDENTITY</span> <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre></div><p>重命名用户名</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">RENAME</span> <span class="token keyword">USER</span> test <span class="token keyword">TO</span> test1<span class="token punctuation">;</span>
</code></pre></div><h4 id="_28-2-2-删除用户"><a href="#_28-2-2-删除用户" class="header-anchor">#</a> 28.2.2 删除用户</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">USER</span> test1<span class="token punctuation">;</span>
</code></pre></div><h4 id="_28-2-3-设置访问权限"><a href="#_28-2-3-设置访问权限" class="header-anchor">#</a> 28.2.3 设置访问权限</h4> <p>新创建的用户账号没有访问权限。它们能登录MySQL，但不能看到数据，不能执行任何数据库操作。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> test<span class="token punctuation">;</span>
</code></pre></div><p>MySQL的权限用用户名和主机名结合定义。如果不指定主机名，则使用默认的主机名%</p> <p>授权：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> webframe<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> test<span class="token punctuation">;</span>
</code></pre></div><p>撤销权限，被撤销的访问权限必须存在，否则会出错。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> webframe<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> test<span class="token punctuation">;</span>
</code></pre></div><p>查看用户权限</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> test<span class="token punctuation">;</span>
</code></pre></div><p>权限对应表
<img src="/database/mysql/mysql_grant.jpg"></p> <h4 id="_28-2-4-更改口令"><a href="#_28-2-4-更改口令" class="header-anchor">#</a> 28.2.4 更改口令</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> test <span class="token operator">=</span> Password<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>不指定用户名时，默认更新当前登录用户口令。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWORD <span class="token operator">=</span> Password<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-05-19 06:19:58</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/mysql/" class="prev router-link-active">
        首页
      </a></span> <span class="next"><a href="/database/mysql/b.html">
        译者序
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.785a8a1a.js" defer></script><script src="/assets/js/2.fa3ecc99.js" defer></script><script src="/assets/js/36.acc00acd.js" defer></script><script src="/assets/js/3.10cb9937.js" defer></script>
  </body>
</html>
