---
title: 第2章 一切都是对象
---

## 2.1 用引用操纵对象

Java 中用**引用**操纵对象。

## 2.2 对象的存储

### 2.2.1 存储到什么地方
程序运行时，内存如何分配。有五个不同的地方可以存储数据。

1. **寄存器**。最快的存储区，位于CPU内部，数量有限，Java中不能直接控制也感受不到它的存在。
2. **堆栈**。位于RAM，即内存中。创建程序时，Java必须知道所有存储在堆栈内所有项的确切生命周期，以便上下移动堆栈指针。指针向下移动，分配新的内存，向上移动，释放对应内存。某些Java数据存储于堆栈中，特别是对象引用，但是Java对象不存储于其中。
3. **堆**。通用的内存池，也位于内存。用于存放所有的Java对象。堆不同堆栈的好处是：编译器不需要知道堆中存储数据的生命周期。因此，在堆里分配存储有很大的灵活性。当需要一个对象时，只需 `new` 写一行简单的代码，当执行时，会自动在堆里进行存储分配。缺点是：用堆进行存储可能会比用堆栈存储分配需要更长时间。
4. **常量存储**。常量值通常直接存放在程序代码内部，它们永远不会被改变。可以选择将其存放在ROM中。
5. **非RAM存储**。如果数据完全存活于程序之外，那么它不受程序的任何控制，在程序没有运行时也可以存在。两个基本的例子是**流对象**和**持久化对象**。**流对象**中，对象转为成字节流，通常发送给另一台机器。**持久化对象**中，对象被存放于磁盘上，因此程序终止也可以保持自己的状态。这种方式的技巧在于：可以把对象转化成可以存放在其它媒介上的食物，需要时可以恢复成常规的RAM对象。

### 2.2.2 特例：基本类型

用 `new` 将对象存储在**堆**里，但是用 `new` 创建一个对象——特别是小的，简单的对象，不是很有效。因此，这里小的简单的类型不用 `new` 来创建变量，而是用并非是引用的**自动变量**。这个变量直接存储值，并置于**堆栈**中，更加高效。

Java的基本数据类型：
- `boolean`。所占存储空间大小没有明确指定。
- `char`。2个字节。
- `byte`。1个字节。
- `short`。2个字节。
- `int`。4个字节。
- `long`。8个字节。
- `float`。4个字节。
- `double`。8个字节。
- `void`。

每个基本都对应一个包装类型。

使用包装类 `new` ,可以在**堆**中创建一个**非基本对象**。

高精度数字：`BigInteger`,`BigDecimal`。能用于`int`和`float`的操作，也同样能用于这两个类型。但是必须以方法调用来取代运算符。运算速度比较慢，这里以速度换取精度。
`BigInteger` 支持任意精度的整数。可以准确表示任何大小的整数值。
`BigDecimal` 支持任何精度的定点数。用它可以进行精确的货币计算。


## 2.3 作用域
### 2.3.1 作用域
大多数面向过程语言都有**作用域**的概念。**作用域**决定了在其内定义的变量名的可见性和生命周期。在C，C++，Java中，**作用域**由**花括号**的位置决定。

在**作用域**里定义的变量只可用于**作用域**结束之前。

### 2.3.2 对象的作用域
Java 对象不具备和基本类型一样的生命周期。当用 `new` 创建一个 Java 对象时，它可以存活于**作用域**之外。例如：
```java
{
    String str = new String("abc");
}
```
引用在**作用域**终点就消失了，但是 **s** 指向的 `String` 对象仍占据内存空间。我们无法在**作用域**之后访问这个对象，因为对它唯一的引用已超出了**作用域**的范围。

由 `new` 创建的对象，只要需要就会一直保留下去。

这带来了一个有趣的问题。

如果 Java 让对象继续存在，那么靠什么才能防止这些对象填满内存空间呢，进而阻塞你的程序。

Java 中有一个**垃圾回收器**，用来监视用 `new` 创建的所有对象，并辨别那些不会再被使用的对象，随后释放这些对象的内存空间，以便供其他新的对象使用。

你不必担心内存回收的问题。你只需要创建对象，一旦不再需要，它们就会自行消失。这样就消除了这类编程问题（“内存泄漏”）。

## 2.4 类定义的组成
用 `class` 关键字创建新的类型。

### 2.4.1 字段和方法
Java 中你所做的工作就是定义类，产生那些类的对象，以及发送消息给这些对象。

一旦定义了类，就可以在类中设置两种类型的元素：字段，方法。字段可以是任何类型的对象，也可以是基本数据类型。如果字段是某个对象的引用，那么必须初始化该引用。

**基本成员默认值**
若某类的成员变量是基本数据类型，即使没有初始化，Java也会确保它获得一个默认值，防止产生程序错误。但是这些初始值可能不是你需要的，因此最好明确地赋初始值。

**注意：**局部变量不能自动初始化，否则在编译时会产生错误。

## 2.5 方法，参数和返回值

方法的基本组成部分包括：名称，参数，返回值和方法体。

方法名和参数列表唯一的标识出某个方法。

方法重写时：
- **子类返回类型可以是父类返回类型的子类。**
- 方法名必须相同。
- 参数列表必须相同。
- 访问权限不能比父类中被重写的方法的访问权限更低。

## 2.6 如何构建一个简单的 Java 程序
### 2.6.1 名字可见性
Java中常见的做法是反转自己的域名，来命名包名以防止模块或类冲突，包名全部小写。

### 2.6.2 运用其它构架
使用 `import` 导入其它**类库**。

### 2.6.3 static 关键字
当使用 `static` 声明一个事物，就表示这个域或对象不与包含它的那个类的任何对象实例关联在一起。这个事物被各个对象共享。面向对象语言中称它为**类数据**或**类方法**。

当 `static` 作用于字段上时，会改变数据创建的方式，因为一个 `static` 字段对每个类来说都只有一份存储空间，而非 `static` 字段则是对每个对象都有一个存储空间。

但是，当 `static` 作用于方法，差别却没那么大，它的一个重要用法就是在不创建任何对象的前提下就可以调用。